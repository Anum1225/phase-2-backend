# ============================================================================
# Docker Compose - Task API Backend
# ============================================================================
# For local development and testing
# Run: docker-compose up

version: '3.8'

services:
  # ============================================================================
  # Backend API Service
  # ============================================================================
  backend:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: task-api-backend
    ports:
      - "8000:8000"
    environment:
      # Load from .env file
      - DATABASE_URL=${DATABASE_URL}
      - BETTER_AUTH_SECRET=${BETTER_AUTH_SECRET}
      - CORS_ORIGINS=${CORS_ORIGINS}
      - HOST=0.0.0.0
      - PORT=8000
    env_file:
      - .env
    volumes:
      # Mount source code for development (hot reload)
      - ./src:/app/src:ro
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:8000/health').read()"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    networks:
      - task-api-network

# ============================================================================
# Networks
# ============================================================================
networks:
  task-api-network:
    driver: bridge

# ============================================================================
# Usage
# ============================================================================
# Start services:
#   docker-compose up
#
# Start in background:
#   docker-compose up -d
#
# View logs:
#   docker-compose logs -f backend
#
# Stop services:
#   docker-compose down
#
# Rebuild and start:
#   docker-compose up --build
#
# Execute command in container:
#   docker-compose exec backend python -c "print('Hello')"
